{"version":3,"sources":["webpack:///webpack/bootstrap 925ec841404b82e91655","webpack:///./test/all.js","webpack:///./test test\\.js$","webpack:///./test/config/config.test.js","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"path\"","webpack:///external \"chai\"","webpack:///./src/config.js","webpack:///external \"babel-runtime/core-js/get-iterator\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/helpers/typeof\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"fs\"","webpack:///./test/synchronize/synchronize.test.js","webpack:///external \"moment\"","webpack:///./src/services/synchronize.js","webpack:///./src/log.js","webpack:///external \"winston\"","webpack:///./src/services/deduplicatePosts.js","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/set\"","webpack:///./src/dataStore/memory/createMemoryDataStore.js","webpack:///external \"fakeredis\"","webpack:///./src/dataStore/redis/RedisDataStore.js","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///./src/services/momentize.js","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///./test/common/provider.mock.js","webpack:///./test/common/feed.mock.js"],"names":["req","keys","forEach","expect","should","describe","it","one","load","config","be","an","constructor","name","eql","optional","configFile","join","__dirname","mandatory","bind","throw","Error","mySection","two","nullSection","emptySection","section","attributes","empty","optionalEmptySection","to","null","beforeEach","process","env","HELLO","HELLO_REFERENCED","SECTION","SECTION_2","ARRAY_SECTION","afterEach","v","Config","source","overrides","promise","loadConfigFromFile","then","resolveConfig","resolve","reject","ResolvedConfig","sectionName","key","defaultValue","value","undefined","interpolateConfigValue","options","newSectionAttributes","newSectionName","interpolateSection","fileName","readFile","err","data","message","JSON","parse","match","interpolateExpression","expression","parts","split","firstPart","part","first","next","length","e","Array","isArray","feed","store","getFeedPosts","Number","MAX_VALUE","storePosts","map","fetchPosts","mockPosts","deep","equal","verifyStore","firstProvider","dataStore","drop","secondProvider","id","created_time","provider","synchronizeProvider","savedLastPostDate","writeStore","loadNewPostsFromProvider","newPosts","savePosts","addPostsToProvider","providers","newFeedDates","synchronizeFeed","savedFeedDates","updates","collectUpdatesInFeed","getPostsFromUpdates","filterPosts","posts","addPostsToFeed","mergeProviderUpdatesToFeed","all","update","getProviderPosts","endDate","startDate","isSame","slice","reduce","allPosts","providerPosts","concat","savedPostDate","pageToken","newFeed","thisPagePosts","i","postDate","isSameOrBefore","push","nextPageToken","loadNewPostsFromProviderRec","nextPagePosts","feedId","getFeedId","info","getProviders","p","error","synchronize","index","filter","isAfter","disableLog","NODE_ENV","RIVUS_LOG_LEVEL","logLevel","prettyLog","RIVUS_LOG_SIMPLE","logParams","console","level","colorize","timestamp","prettyPrint","humanReadableUnhandledException","log","loggers","add","get","remove","transports","Console","deduplicatePosts","DEDUPLICATION_TIME_WINDOW","duplicateIds","findDuplicates","groupPostsByTimeWindow","has","postsByTimeWindow","window","Math","floor","post","valueOf","sort","p1","p2","providerPriority","providerName","createMemoryDataStore","fakeClient","createClient","fast","client","postIds","redisQuery","Keys","loadPostsByIds","command","args","debug","arg","response","warn","providerLastPostDate","providerPostIds","feedLastPostDates","f","feedPostIds","RedisDataStore","updater","lastPostDateKey","dateFromRedis","RedisWriteDataStore","newProviderLastPostDate","saveLastProviderPostDate","commit","discard","lastPostDatesKey","lastPostDates","newLastPostDates","saveLastFeedPostDates","offset","limit","dateToRedis","multi","redisOneOffQuery","arr","date","dates","redisDate","momentize","demomentize","isMoment","ProviderMock","Object","defineProperty","_posts","addPost","start","end","postDateDescComparator","diff","FeedMock","_feedId","_providers","feeds"],"mappings":"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","file":"test.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 925ec841404b82e91655","const req = require.context('./', true, /test\\.js$/);\nreq.keys().forEach(req);\n\n\n\n// WEBPACK FOOTER //\n// ./test/all.js","var map = {\n\t\"./config/config.test.js\": 2,\n\t\"./synchronize/synchronize.test.js\": 15\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./test test\\.js$\n// module id = 1\n// module chunks = 0","import path from 'path';\n\nimport chai from 'chai';\nconst expect = chai.expect;\nchai.should();\nimport Config from '../../src/config';\n\n\ndescribe('Config', function() {\n  it('accepts object as an initializer', async function() {\n    const config = await new Config({ one: 'two' }).load();\n\n    config.should.be.an('object');\n    config.constructor.name.should.eql('ResolvedConfig');\n    config.optional('one', 'one').should.eql('two');\n  });\n\n  it('accepts file name as an initializer', async function() {\n    const configFile = path.join(__dirname, 'config.json');\n    const config = await new Config(configFile).load();\n\n    config.should.be.an('object');\n    config.constructor.name.should.eql('ResolvedConfig');\n    config.optional('one', 'one').should.eql('one-one-one');\n  });\n\n  it('has a method to get optional value with a default', async function() {\n    const config = await new Config({ one: 'two' }).load();\n    config.optional('missing', 'xxx').should.eql('xxx');\n  });\n\n  it('has a method to throw an exception if mandatory value is missing', async function() {\n    const config = await new Config({ one: 'two' }).load();\n\n    config.mandatory.bind(config, 'missing').should.throw(Error);\n  });\n\n  it('has a method to obtain a config section', async function() {\n    const config = await new Config({\n      one: 'two',\n      mySection: {\n        two: 'three'\n      },\n      nullSection: null\n    }).load();\n\n    const emptySection = config.section('missing');\n    emptySection.should.be.an('object');\n    emptySection.attributes.should.be.empty;\n\n    const optionalEmptySection = config.section('missing', { optional: true });\n    expect(optionalEmptySection).to.be.null;\n\n    const section = config.section('mySection');\n    section.should.be.an('object');\n    section.optional('two').should.eql('three');\n\n    const nullSection = config.section('nullSection', { optional: true });\n    expect(nullSection).to.be.null;\n  });\n\n  describe('interpolation', function() {\n    beforeEach(() => {\n      process.env.HELLO = 'World!';\n      process.env.HELLO_REFERENCED = '${HELLO}';\n      process.env.SECTION = '{\"someValue\": 100500}';\n      process.env.SECTION_2 = '{\"someValue\": {\"otherValue\": 100500}}';\n      process.env.ARRAY_SECTION = '{\"arrayValue\": [{\"someValue\": 10}]}';\n    });\n\n    afterEach(() => {\n      delete process.env.HELLO;\n      delete process.env.HELLO_REFERENCED;\n      delete process.env.SECTION;\n      delete process.env.SECTION_2;\n      delete process.env.ARRAY_SECTION;\n    });\n\n    it('expands expressions with environment variables', async function() {\n      const config = await new Config({\n        one: '${HELLO}'\n      }).load();\n      config.mandatory('one').should.eql('World!');\n    });\n\n    it('expands expressions', async function() {\n      const config = await new Config({\n        one: '${HELLO_REFERENCED}'\n      }).load();\n      config.mandatory('one').should.eql('World!');\n    });\n\n    it('expands longer expressions', async function() {\n      const config = await new Config({\n        one: '${SECTION_2.someValue.otherValue}'\n      }).load();\n      config.mandatory('one').should.eql(100500);\n    });\n\n    it('ignores unset variables for optional cases', async function() {\n      delete process.env.HELLO;\n\n      const config = await new Config({\n        one: '${HELLO_REFERENCED}'\n      }).load();\n\n      config.optional('one', 'two').should.eql('two');\n    });\n\n    it('interpolates expressions with sections JSON', async function() {\n      const config = await new Config({\n        one: '${SECTION}'\n      }).load();\n      config.section('one').mandatory('someValue').should.eql(100500);\n    });\n\n    it('ignores unset variables for optional sections', async function() {\n      const config = await new Config({\n        one: '${SECTIONX}'\n      }).load();\n\n      expect(config.section('one', { optional: true })).to.be.null;\n    });\n\n    it('resolves arrays with a single elements', async function() {\n      const config = await new Config({\n        v: '${ARRAY_SECTION.arrayValue.someValue}'\n      }).load();\n\n      config.mandatory('v').should.eql(10);\n    });\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./test/config/config.test.js","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/asyncToGenerator\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"chai\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chai\"\n// module id = 6\n// module chunks = 0","import fs from 'fs';\n\n\nexport default class Config {\n  constructor(source, overrides = {}) {\n    if (typeof source === 'string') {\n      this.promise = loadConfigFromFile(source)\n        .then((config) => resolveConfig(config, overrides));\n    } else if (typeof source === 'object') {\n      this.promise = Promise.resolve(resolveConfig(source, overrides));\n    } else {\n      this.promise = Promise.reject(new Error(`invalid configuration parameter: ${typeof source}`));\n    }\n  }\n\n  load() {\n    return this.promise;\n  }\n}\n\n\nexport class ResolvedConfig {\n  constructor(attributes = {}, section = null) {\n    this.attributes = attributes;\n    this.sectionName = section;\n  }\n\n  optional(key, defaultValue) {\n    let value = this.attributes[key];\n\n    if (value !== undefined) {\n      value = interpolateConfigValue(value, true);\n    }\n\n    return value === undefined ? defaultValue : value;\n  }\n\n  mandatory(key) {\n    if (this.attributes[key] !== undefined) {\n      return interpolateConfigValue(this.attributes[key]);\n    }\n    throw new Error(`missing mandatory option [${key}] in config ${this.sectionName}`);\n  }\n\n  section(key, options = { optional: false }) {\n    const newSectionAttributes = this.attributes[key];\n    const newSectionName = this.sectionName ? `${this.sectionName}.${key}` : key;\n\n    if (!newSectionAttributes) {\n      return options.optional ? null : new ResolvedConfig({}, newSectionName);\n    }\n\n    switch (typeof newSectionAttributes) {\n      case 'object':\n        return new ResolvedConfig(newSectionAttributes, newSectionName);\n      case 'string':\n        return interpolateSection(newSectionAttributes, newSectionName, options.optional);\n      default:\n        throw new Error(`config: option [${key}] should be an object`);\n    }\n  }\n}\n\n\nfunction loadConfigFromFile(fileName) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(fileName, 'utf8', (err, data) => {\n      if (err) {\n        reject(new Error(`error reading config file: ${err.message}`));\n      } else {\n        resolve(JSON.parse(data));\n      }\n    });\n  });\n}\n\nfunction resolveConfig(attributes, overrides) {\n  return new ResolvedConfig(Object.assign({}, attributes, overrides));\n}\n\nfunction interpolateConfigValue(value, optional = false) {\n  if (typeof value === 'string') {\n    const match  = value.match(/^\\${(.+)}$/);\n    if (match) {\n      return interpolateConfigValue(\n        interpolateExpression(match[1], optional),\n        optional\n      );\n    }\n  }\n\n  return value;\n}\n\nfunction interpolateExpression(expression, optional = false) {\n  const parts = expression.split('.');\n  let firstPart = true;\n  let value = null;\n\n  for (const part of parts) {\n    if (firstPart) {\n      firstPart = false;\n      value = first(part, optional);\n      if (value === undefined && optional) {\n        return undefined;\n      }\n      if (value === 'true' || value === 'false') {\n        value = JSON.parse(value);\n      }\n    } else {\n      value = next(value, part);\n    }\n  }\n\n  return value;\n\n  function first(part, optional) {\n    if (!process.env[part]) {\n      if (optional) {\n        return undefined;\n      }\n\n      throw new Error(\n        `config: cannot interpolate expression [${expression}]: ` +\n        `environment variable ${part} is not set`\n      );\n    }\n\n    let value = process.env[part];\n\n    if (parts.length > 1) {\n      try {\n        value = JSON.parse(value);\n      } catch (e) {\n        throw new Error(\n          `config: cannot interpolate expression [${expression}]: ` +\n          `environment variable ${part} is not a valid JSON`\n        );\n      }\n    }\n\n    return value;\n  }\n\n  function next(value, part) {\n    if (Array.isArray(value)) {\n      if (value.length !== 1) {\n        throw new Error(\n          `config: cannot interpolate expression [${expression}]: ` +\n          `item [${part}] is an array of length ${value.length}`\n        );\n      }\n      return next(value[0], part);\n\n    } else if (typeof value === 'object') {\n      return value[part];\n\n    } else {\n      throw new Error(\n        `config: cannot interpolate expression [${expression}]: ` +\n        `key path missing at ${part}`\n      );\n    }\n  }\n}\n\nfunction interpolateSection(expression, sectionName, optional) {\n  let attributes = interpolateConfigValue(expression, optional);\n\n  if (attributes) {\n    try {\n      attributes = JSON.parse(attributes);\n      if (typeof attributes !== 'object') {\n        attributes = null;\n      }\n    } catch (e) {\n      attributes = null;\n    }\n\n    if (!attributes) {\n      throw new Error(\n        `config: ${sectionName}: cannot interpolate expression [${expression}]: ` +\n        'object expected'\n      );\n    }\n  }\n\n  if (attributes) {\n    return new ResolvedConfig(attributes, sectionName);\n  } else if (!optional) {\n    return new ResolvedConfig({}, sectionName);\n  } else {\n    return null;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","module.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/get-iterator\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/assign\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/typeof\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/typeof\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 14\n// module chunks = 0","import chai from 'chai';\nconst expect = chai.expect;\nchai.should();\n\nimport moment from 'moment';\n\nimport synchronize from '../../src/services/synchronize';\nimport createMemoryDataStore from '../../src/dataStore/memory/createMemoryDataStore';\nimport ProviderMock from '../common/provider.mock';\nimport FeedMock from '../common/feed.mock';\nimport { demomentize } from '../../src/services/momentize';\n\n\ndescribe('synchronization', function() {\n  describe('with a single provider', function() {\n    beforeEach(function() {\n      this.firstProvider = firstProvider();\n      this.feed = new FeedMock('f', [this.firstProvider]);\n      this.dataStore = createMemoryDataStore();\n    });\n\n    afterEach(async function() {\n      await this.dataStore.drop();\n    });\n\n    it('works properly on initial run', async function() {\n      await synchronize(this.feed, this.dataStore);\n      await verifyStore(this.feed, this.dataStore);\n    });\n  });\n\n  describe('with two providers', function() {\n    beforeEach(function() {\n      this.firstProvider = firstProvider();\n      this.secondProvider = secondProvider();\n      this.feed = new FeedMock('f', [this.firstProvider, this.secondProvider]);\n      this.dataStore = createMemoryDataStore();\n    });\n\n    afterEach(async function() {\n      await this.dataStore.drop();\n    });\n\n    it('works properly on initial run', async function() {\n      await synchronize(this.feed, this.dataStore);\n      await verifyStore(this.feed, this.dataStore);\n    });\n  });\n});\n\nasync function verifyStore(feed, store) {\n  const storePosts = (await store.getFeedPosts(feed, 0, Number.MAX_VALUE)).map(demomentize);\n  const mockPosts = (await feed.fetchPosts(Number.MAX_VALUE)).map(demomentize);\n  expect(mockPosts).to.deep.equal(storePosts, 'expected posts are not in data store');\n}\n\nfunction firstProvider() {\n  return new ProviderMock('p1', [{\n    id: 'p1-1',\n    created_time: moment(0),\n    source: { name: 'p1' }\n  }, {\n    id: 'p1-2',\n    created_time: moment(10000),\n    source: { name: 'p1' }\n  }, {\n    id: 'p1-3',\n    created_time: moment(100000),\n    source: { name: 'p1' }\n  }]);\n}\n\nfunction secondProvider() {\n  return new ProviderMock('p2', [{\n    id: 'p2-1',\n    created_time: moment(5000),\n    source: { name: 'p2' }\n  }, {\n    id: 'p2-2',\n    created_time: moment(50000),\n    source: { name: 'p2' }\n  }, {\n    id: 'p2-3',\n    created_time: moment(500000),\n    source: { name: 'p2' }\n  }]);\n}\n\n\n// WEBPACK FOOTER //\n// ./test/synchronize/synchronize.test.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 16\n// module chunks = 0","import log from '../log';\nimport deduplicatePosts from '../services/deduplicatePosts';\n\n\nexport default async function synchronize(feed, dataStore) {\n  const feedId = feed.getFeedId();\n\n  log.info(`synchronizing feed ${feedId}...`);\n\n  try {\n    const providers = feed.getProviders();\n    const newFeedDates = await Promise.all(providers.map(p => synchronizeProvider(dataStore, p)));\n    await mergeProviderUpdatesToFeed(feed, dataStore, providers, newFeedDates);\n\n    log.info(`completed synchronizing feed ${feedId}`);\n  } catch (e) {\n    log.error(`error while synchronizing feed ${feedId}`, e);\n    throw e;\n  }\n}\n\nasync function synchronizeProvider(dataStore, provider) {\n  return await dataStore.synchronizeProvider(provider, async(savedLastPostDate, writeStore) => {\n    const newPosts = await loadNewPostsFromProvider(provider, savedLastPostDate);\n    if (!newPosts.length) {\n      return savedLastPostDate;\n    }\n    writeStore.savePosts(newPosts);\n    writeStore.addPostsToProvider(provider, newPosts);\n    return newPosts[0].created_time;\n  });\n}\n\nasync function mergeProviderUpdatesToFeed(feed, dataStore, providers, newFeedDates) {\n  return await dataStore.synchronizeFeed(feed, async(savedFeedDates, writeStore) => {\n    const updates = collectUpdatesInFeed(providers, savedFeedDates, newFeedDates);\n\n    if (!updates.length) {\n      return savedFeedDates;\n    }\n    \n    const posts = deduplicatePosts(feed.filterPosts(await getPostsFromUpdates(updates, dataStore)));\n    writeStore.addPostsToFeed(feed, posts);\n\n    return newFeedDates;\n  });\n}\n\nfunction collectUpdatesInFeed(providers, savedFeedDates, newFeedDates) {\n  return providers\n    .map((provider, index) => {\n      let startDate = savedFeedDates ? savedFeedDates[index] : null;\n      const endDate = newFeedDates[index];\n\n      if (!startDate && !endDate) {\n        return null;\n      }\n\n      return {\n        provider: provider,\n        startDate: startDate,\n        endDate: endDate\n      };\n    })\n    .filter(update => !!update && (!update.startDate || update.endDate.isAfter(update.startDate)));\n}\n\nasync function getPostsFromUpdates(updates, dataStore) {\n  const posts = await Promise.all(updates.map(async(update) => {\n      const posts = await dataStore.getProviderPosts(update.provider, update.endDate, update.startDate);\n\n      if (update.startDate && update.startDate.isSame(posts[posts.length - 1].created_time)) {\n        return posts.slice(0, -1);\n      } else {\n        return posts;\n      }\n    })\n  );\n\n  return posts.reduce((allPosts, providerPosts) => allPosts.concat(providerPosts), []);\n}\n\nasync function loadNewPostsFromProvider(provider, savedPostDate) {\n  async function loadNewPostsFromProviderRec(pageToken) {\n    const newFeed = await provider.fetchPosts(20, pageToken);\n    const thisPagePosts = [];\n\n    for (let i = 0; i < newFeed.posts.length; i++) {\n      const postDate = newFeed.posts[i].created_time;\n\n      if (!!savedPostDate && postDate.isSameOrBefore(savedPostDate)) {\n        return thisPagePosts;\n      }\n\n      thisPagePosts.push(newFeed.posts[i]);\n    }\n\n    if (!thisPagePosts.length || !newFeed.nextPageToken) {\n      return thisPagePosts;\n    }\n\n    const nextPagePosts = await loadNewPostsFromProviderRec(newFeed.nextPageToken);\n    return thisPagePosts.concat(nextPagePosts);\n  }\n\n  return await loadNewPostsFromProviderRec();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/synchronize.js","import winston from 'winston';\n\nconst disableLog = process.env.NODE_ENV === 'test' && !process.env.RIVUS_LOG_LEVEL;\nconst logLevel = process.env.RIVUS_LOG_LEVEL || 'info';\nconst prettyLog = !process.env.RIVUS_LOG_SIMPLE;\n\nconst logParams = {\n  console: {\n    level: logLevel,\n    colorize: prettyLog,\n    timestamp: true,\n    prettyPrint: prettyLog,\n    humanReadableUnhandledException: true\n  }\n};\n\n\nconst log = winston.loggers.add('rivus', logParams);\nif (disableLog) {\n  winston.loggers.get('rivus').remove(winston.transports.Console)\n}\n\nexport default log;\n\n\n\n// WEBPACK FOOTER //\n// ./src/log.js","module.exports = require(\"winston\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"winston\"\n// module id = 19\n// module chunks = 0","const DEDUPLICATION_TIME_WINDOW = 3000; // 3 seconds\n\nexport default function deduplicatePosts(posts) {\n  // TODO: make me smarter\n  const duplicateIds = findDuplicates(groupPostsByTimeWindow(posts));\n  return posts.filter(p => !duplicateIds.has(p.id));\n}\n\nfunction groupPostsByTimeWindow(posts) {\n  const postsByTimeWindow = {};\n\n  posts.forEach(post => {\n    const window = Math.floor(post.created_time.valueOf() / DEDUPLICATION_TIME_WINDOW);\n    postsByTimeWindow[window] = postsByTimeWindow[window] || [];\n    postsByTimeWindow[window].push(post);\n  });\n\n  return postsByTimeWindow;\n}\n\nfunction findDuplicates(postsByTimeWindow) {\n  const duplicateIds = new Set();\n\n  Object.keys(postsByTimeWindow).forEach(window => {\n    const posts = postsByTimeWindow[window];\n    if (posts.length > 0) {\n      posts\n        .sort((p1, p2) => providerPriority(p1.source.name) - providerPriority(p2.source.name))\n        .slice(1)\n        .forEach(p => duplicateIds.add(p.id));\n    }\n  });\n\n  return duplicateIds;\n}\n\nfunction providerPriority(providerName){\n  switch (providerName) {\n    case 'instagram':\n      return 100;\n    case 'medium':\n      return 50;\n    case 'facebook':\n      return 5;\n    case 'twitter':\n      return 1;\n    default:\n      return 0;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/deduplicatePosts.js","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/set\"\n// module id = 22\n// module chunks = 0","import fakeredis from 'fakeredis';\n\nimport log from '../../log';\nimport RedisDataStore from '../redis/RedisDataStore';\n\n\nexport default function createMemoryDataStore() {\n  log.info('riv-us: using in-memory data store');\n\n  const fakeClient = fakeredis.createClient(888, 'riv-us', { fast: true });\n\n  return new RedisDataStore(fakeClient);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/memory/createMemoryDataStore.js","module.exports = require(\"fakeredis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fakeredis\"\n// module id = 24\n// module chunks = 0","import moment from 'moment';\n\nimport log from '../../log';\nimport { momentize, demomentize } from '../../services/momentize';\n\nconst Keys = {\n  post: id => `rivus:posts:${id}`,\n  providerLastPostDate: p => `rivus:anchor:provider:${p.feedId}`,\n  providerPostIds: p => `rivus:provider:${p.feedId}`,\n  feedLastPostDates: f => `rivus:anchor:feed:${f.getFeedId()}`,\n  feedPostIds: f => `rivus:feed:${f.getFeedId()}`\n};\n\n\nexport default class RedisDataStore {\n  constructor(client) {\n    this.client = client;\n  }\n\n  async synchronizeProvider(provider, updater) {\n    const lastPostDateKey = Keys.providerLastPostDate(provider);\n\n    await redisQuery(this.client, 'watch', lastPostDateKey);\n\n    const providerLastPostDate = dateFromRedis(await redisQuery(this.client, 'get', lastPostDateKey));\n\n    const writeStore = new RedisWriteDataStore(this.client);\n\n    try {\n      const newProviderLastPostDate = await updater(providerLastPostDate, writeStore);\n      writeStore.saveLastProviderPostDate(provider, newProviderLastPostDate);\n      await writeStore.commit();\n      return newProviderLastPostDate;\n\n    } catch (e) {\n      log.warn(`Redis: error while synchronizing provider \\`${provider.feedId}\\`:`, e);\n      writeStore.discard();\n      throw e;\n    }\n  }\n\n  async synchronizeFeed(feed, updater) {\n    const lastPostDatesKey = Keys.feedLastPostDates(feed);\n\n    await redisQuery(this.client, 'watch', lastPostDatesKey);\n\n    let lastPostDates = await redisQuery(this.client, 'get', lastPostDatesKey);\n    if (lastPostDates) {\n      lastPostDates = JSON.parse(lastPostDates);\n      if (Array.isArray(lastPostDates)) {\n        lastPostDates = lastPostDates.map(dateFromRedis);\n      } else {\n        lastPostDates = null;\n      }\n    }\n\n    const writeStore = new RedisWriteDataStore(this.client);\n\n    try {\n      const newLastPostDates = await updater(lastPostDates, writeStore);\n      writeStore.saveLastFeedPostDates(feed, newLastPostDates);\n      await writeStore.commit();\n      return newLastPostDates;\n\n    } catch (e) {\n      log.warn(`Redis: error while synchronizing feed \\`${feed.getFeedId()}\\`:`, e);\n      writeStore.discard();\n      throw e;\n    }\n  }\n\n  async getFeedPosts(feed, offset = 0, limit = 10) {\n    const postIds = await redisQuery(\n      this.client,\n      'zrevrangebyscore',\n      Keys.feedPostIds(feed),\n      Number.MAX_VALUE,\n      0,\n      'LIMIT',\n      offset,\n      limit\n    );\n\n    return await loadPostsByIds(this.client, postIds);\n  }\n\n  async getProviderPosts(provider, endDate = null, startDate = null) {\n    const postIds = await redisQuery(\n      this.client,\n      'zrangebyscore',\n      Keys.providerPostIds(provider),\n      dateToRedis(startDate, '-inf'),\n      dateToRedis(endDate, '+inf')\n    );\n\n    return await loadPostsByIds(this.client, postIds);\n  }\n\n  async drop() {\n    return await redisQuery(this.client, 'flushdb');\n  }\n}\n\n\nclass RedisWriteDataStore {\n  constructor(client) {\n    this.client = client.multi();\n  }\n\n  async commit() {\n    return await redisQuery(this.client, 'exec');\n  }\n\n  discard() {\n    redisOneOffQuery(this.client, 'discard');\n  }\n\n  savePosts(posts) {\n    if (!posts.length) {\n      return;\n    }\n    const args = posts.reduce((arr, post) => [...arr, Keys.post(post.id), JSON.stringify(demomentize(post))], []);\n    redisOneOffQuery(this.client, 'mset', ...args)\n  }\n\n  saveLastProviderPostDate(provider, date) {\n    redisOneOffQuery(this.client, 'set', Keys.providerLastPostDate(provider), dateToRedis(date));\n  }\n\n  saveLastFeedPostDates(feed, dates) {\n    redisOneOffQuery(\n      this.client,\n      'set',\n      Keys.feedLastPostDates(feed),\n      dates ? JSON.stringify(dates.map(dateToRedis)) : null\n    );\n  }\n\n  addPostsToFeed(feed, posts) {\n    if (!posts.length) {\n      return;\n    }\n\n    const args = posts.reduce((arr, post) => [...arr, dateToRedis(post.created_time), post.id], []);\n    redisOneOffQuery(this.client, 'zadd', Keys.feedPostIds(feed), ...args);\n  }\n\n  addPostsToProvider(provider, posts) {\n    if (!posts.length) {\n      return;\n    }\n\n    const args = posts.reduce((arr, post) => [...arr, dateToRedis(post.created_time), post.id], []);\n    redisOneOffQuery(this.client, 'zadd', Keys.providerPostIds(provider), ...args);\n  }\n}\n\nasync function loadPostsByIds(client, postIds) {\n  if (!postIds.length) {\n    return [];\n  }\n  return (await redisQuery(client, 'mget', ...postIds.map(Keys.post)))\n    .map(data => momentize(JSON.parse(data)));\n}\n\nasync function redisQuery(client, command, ...args) {\n  log.debug(`Redis: ${command}`, ...args.map(arg => `\"${arg}\"`));\n\n  return await new Promise((resolve, reject) => {\n    if (!client[command]) {\n      reject(new Error(`Redis: undefined command ${command}`));\n      return;\n    }\n\n    client[command](...[...args, (err, response) => {\n      if (err) {\n        log.warn(`Redis: error ${command}`, ...args.map(arg => `\"${arg}\"`), ':', err);\n        reject(new Error(`Redis: ${err.message}`));\n      } else {\n        resolve(response);\n      }\n    }]);\n  });\n}\n\nfunction redisOneOffQuery(client, command, ...args) {\n  log.debug(`Redis: ${command}`, ...args.map(arg => `\"${arg}\"`));\n\n  if (!client[command]) {\n    throw new Error(`Redis: undefined command ${command}`);\n  }\n\n  client[command](...args);\n}\n\nfunction dateToRedis(date, defaultValue) {\n  return date ? date.valueOf() : defaultValue;\n}\n\nfunction dateFromRedis(redisDate) {\n  return redisDate ? moment(Number(redisDate)) : null;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/redis/RedisDataStore.js","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/toConsumableArray\"\n// module id = 27\n// module chunks = 0","import moment from 'moment';\n\nexport function momentize(post) {\n  if (!moment.isMoment(post.created_time)) {\n    return {\n      ...post,\n      created_time: moment(post.created_time)\n    };\n  }\n  return post;\n}\n\nexport function demomentize(post) {\n  if (moment.isMoment(post.created_time)) {\n    return {\n      ...post,\n      created_time: post.created_time.valueOf()\n    };\n  }\n  return post;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/momentize.js","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 29\n// module chunks = 0","export default class ProviderMock {\n  constructor(id, posts) {\n    Object.defineProperty(this, 'feedId', {\n      get: () => id\n    });\n\n    this._posts = [];\n    posts.forEach(p => this.addPost(p));\n  }\n\n  async fetchPosts(limit = 10, pageToken = null) {\n    const start = pageToken ? pageToken : 0;\n    const end = start + limit;\n\n    return {\n      posts: this._posts.slice(start, end),\n      nextPageToken: end < this._posts.length ? end : null\n    };\n  }\n\n  addPost(post) {\n    this._posts.push(post);\n    this._posts.sort(postDateDescComparator);\n  }\n}\n\nfunction postDateDescComparator(p1, p2) {\n  // moment.js date/time comparison\n  return p2.created_time.diff(p1.created_time);\n}\n\n\n// WEBPACK FOOTER //\n// ./test/common/provider.mock.js","export default class FeedMock {\n  constructor(id, providers) {\n    this._feedId = id;\n    this._providers = providers;\n  }\n\n  getProviders() {\n    return this._providers;\n  }\n\n  getFeedId() {\n    return this._feedId;\n  }\n\n  filterPosts(posts) {\n    return posts;\n  }\n\n  async fetchPosts(options) {\n    const feeds = await Promise.all(this._providers.map(p => p.fetchPosts(options.limit)));\n\n    return feeds\n      .reduce((allPosts, feed) => allPosts.concat(feed.posts), [])\n      .sort(postDateDescComparator);\n  }\n}\n\nfunction postDateDescComparator(p1, p2) {\n  // moment.js date/time comparison\n  return p2.created_time.diff(p1.created_time);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./test/common/feed.mock.js"],"sourceRoot":""}