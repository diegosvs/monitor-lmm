{"version":3,"sources":["webpack:///webpack/bootstrap 8287f1ac04ada6d7f9bb","webpack:///./src/rivus.js","webpack:///external \"babel-runtime/helpers/typeof\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///./src/config.js","webpack:///external \"babel-runtime/core-js/get-iterator\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"fs\"","webpack:///./src/dataStore/createDataStore.js","webpack:///./src/dataStore/redis/createRedisDataStore.js","webpack:///./src/dataStore/redis/RedisDataStore.js","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///external \"moment\"","webpack:///./src/log.js","webpack:///external \"winston\"","webpack:///./src/services/momentize.js","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///./src/dataStore/redis/createRedisClient.js","webpack:///external \"redis\"","webpack:///./src/dataStore/memory/createMemoryDataStore.js","webpack:///external \"fakeredis\"","webpack:///./src/feed/createFeed.js","webpack:///./src/providers/createProvider.js","webpack:///./src/providers/facebook/facebook.js","webpack:///external \"querystring\"","webpack:///external \"url\"","webpack:///./src/providers/facebook/accessToken.js","webpack:///./src/providers/facebook/graphApiRequest.js","webpack:///external \"https\"","webpack:///./src/providers/twitter/twitter.js","webpack:///external \"twitter\"","webpack:///./src/providers/rss/rss.js","webpack:///external \"feed-read\"","webpack:///./src/providers/medium/medium.js","webpack:///./src/providers/instagram/instagram.js","webpack:///./src/feed/getFeedId.js","webpack:///./src/services/synchronize.js","webpack:///./src/services/deduplicatePosts.js","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/set\""],"names":["feed","dataStore","options","feedOptions","cookGetFeedOptions","getFeedPosts","offset","limit","getFeed","Rivus","baseConfig","configOverrides","config","feedPromise","dataStorePromise","filter","add","addFilter","remove","removeFilter","rivus","get","maybeLimit","maybeCallback","callback","then","results","error","synchronize","Object","defineProperty","inputOptions","Array","isArray","Config","source","overrides","promise","loadConfigFromFile","resolveConfig","resolve","reject","Error","ResolvedConfig","attributes","section","sectionName","key","defaultValue","value","undefined","interpolateConfigValue","optional","newSectionAttributes","newSectionName","interpolateSection","fileName","readFile","err","data","message","JSON","parse","match","interpolateExpression","expression","parts","split","firstPart","part","first","next","process","env","length","e","load","dataStoreConfig","createDataStore","createRedisDataStore","client","postIds","redisQuery","map","Keys","post","loadPostsByIds","command","args","debug","arg","response","warn","id","providerLastPostDate","p","feedId","providerPostIds","feedLastPostDates","f","getFeedId","feedPostIds","RedisDataStore","provider","updater","lastPostDateKey","dateFromRedis","writeStore","RedisWriteDataStore","newProviderLastPostDate","saveLastProviderPostDate","commit","discard","lastPostDatesKey","lastPostDates","newLastPostDates","saveLastFeedPostDates","Number","MAX_VALUE","endDate","startDate","dateToRedis","multi","redisOneOffQuery","posts","reduce","arr","date","dates","created_time","valueOf","redisDate","disableLog","NODE_ENV","RIVUS_LOG_LEVEL","logLevel","prettyLog","RIVUS_LOG_SIMPLE","logParams","console","level","colorize","timestamp","prettyPrint","humanReadableUnhandledException","log","loggers","transports","Console","momentize","demomentize","isMoment","createRedisClient","storeName","params","path","host","port","password","createClient","on","info","createMemoryDataStore","fakeClient","fast","loadedConfig","providers","mandatory","providerAttributes","filters","getProviders","i","indexOf","push","splice","filterPosts","every","createFeed","createProvider","name","userId","accessToken","nextPageToken","endpoint","fields","encode","request","cookFeedItem","paging","fetchPosts","createFacebookProvider","pageToken","concat","parseImages","images","picture","thumbnail","url","full_picture","content","title","Date","getTime","link","extra","original","appId","appSecret","client_id","client_secret","grant_type","responseString","items","requestNewAccessToken","createAccessToken","invalidate","FACEBOOK_HOST","headers","hostname","statusCode","responseData","toString","plainResponse","json","code","error_subcode","error_user_title","error_user_message","statusMessage","graphApiRequest","createTwitterProvider","user","feedIdForUser","twitter","consumer_key","consumer_secret","access_token_key","access_token_secret","screen_name","count","max_id","tweets","cookFeedPost","t","slice","text","created_at","extended_entities","id_str","entities","media","media_url_https","media_url","createRssProvider","feedUrl","providerName","verbose","published","rex","exec","createMediumProvider","createRssConfig","mediumConfig","customDomainUrl","pathname","format","type","createInstagramProvider","API_BASE_URL","access_token","next_max_id","stringify","body","meta","pagination","caption","substring","standard_resolution","sort","p1","p2","f1","f2","join","synchronizeProvider","savedLastPostDate","loadNewPostsFromProvider","newPosts","savePosts","addPostsToProvider","newFeedDates","synchronizeFeed","savedFeedDates","updates","collectUpdatesInFeed","getPostsFromUpdates","addPostsToFeed","mergeProviderUpdatesToFeed","all","update","getProviderPosts","isSame","allPosts","providerPosts","savedPostDate","newFeed","thisPagePosts","postDate","isSameOrBefore","loadNewPostsFromProviderRec","nextPagePosts","index","isAfter","deduplicatePosts","DEDUPLICATION_TIME_WINDOW","duplicateIds","findDuplicates","groupPostsByTimeWindow","has","postsByTimeWindow","forEach","window","Math","floor","providerPriority"],"mappings":"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","file":"rivus.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8287f1ac04ada6d7f9bb","import Config from './config';\nimport createDataStore from './dataStore/createDataStore';\nimport createFeed from './feed/createFeed';\nimport synchronize from './services/synchronize';\n\n\nexport default function Rivus(baseConfig, configOverrides = {}) {\n  const config = new Config(baseConfig, configOverrides);\n  const feedPromise = createFeed(config);\n  const dataStorePromise = createDataStore(config);\n\n  const filter = {\n    add: async(filter) => {\n      const feed = await feedPromise;\n      feed.addFilter(filter);\n    },\n    remove: async(filter) => {\n      const feed = await feedPromise;\n      feed.removeFilter(filter);\n    }\n  };\n\n  const rivus = {\n    get: (maybeLimit, maybeCallback) => {\n      let limit = maybeLimit || 10;\n      let callback = () => {};\n\n      if (typeof maybeCallback === 'function') {\n        callback = maybeCallback;\n      } else if (maybeLimit === 'function') {\n        limit = 10;\n        callback = maybeLimit;\n      }\n\n      return this.getFeed({ limit }).then(function(results) {\n        callback(null, results);\n      }, function(error) {\n        callback(error);\n      });\n    },\n    getFeed: async(options) => {\n      const feed = await feedPromise;\n      const dataStore = await dataStorePromise;\n      return await getFeed(feed, dataStore, options)\n    },\n    synchronize: async() => {\n      const feed = await feedPromise;\n      const dataStore = await dataStorePromise;\n      return await synchronize(feed, dataStore);\n    }\n  };\n\n  Object.defineProperty(rivus, 'filter', {\n    get: () => filter\n  });\n\n  return rivus;\n}\n\nasync function getFeed(feed, dataStore, options) {\n  const feedOptions = cookGetFeedOptions(options);\n  return await dataStore.getFeedPosts(feed, feedOptions.offset, feedOptions.limit);\n}\n\nfunction cookGetFeedOptions(inputOptions) {\n  const options = {\n    offset: 0,\n    limit: 10\n  };\n\n  if (typeof inputOptions === 'number') {\n    Object.assign(options, { limit: inputOptions });\n\n  } else if (typeof inputOptions === 'object' && !Array.isArray(inputOptions)) {\n    Object.assign(options, inputOptions);\n  }\n\n  return options;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rivus.js","module.exports = require(\"babel-runtime/helpers/typeof\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/typeof\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/assign\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/asyncToGenerator\"\n// module id = 4\n// module chunks = 0","import fs from 'fs';\n\n\nexport default class Config {\n  constructor(source, overrides = {}) {\n    if (typeof source === 'string') {\n      this.promise = loadConfigFromFile(source)\n        .then((config) => resolveConfig(config, overrides));\n    } else if (typeof source === 'object') {\n      this.promise = Promise.resolve(resolveConfig(source, overrides));\n    } else {\n      this.promise = Promise.reject(new Error(`invalid configuration parameter: ${typeof source}`));\n    }\n  }\n\n  load() {\n    return this.promise;\n  }\n}\n\n\nexport class ResolvedConfig {\n  constructor(attributes = {}, section = null) {\n    this.attributes = attributes;\n    this.sectionName = section;\n  }\n\n  optional(key, defaultValue) {\n    let value = this.attributes[key];\n\n    if (value !== undefined) {\n      value = interpolateConfigValue(value, true);\n    }\n\n    return value === undefined ? defaultValue : value;\n  }\n\n  mandatory(key) {\n    if (this.attributes[key] !== undefined) {\n      return interpolateConfigValue(this.attributes[key]);\n    }\n    throw new Error(`missing mandatory option [${key}] in config ${this.sectionName}`);\n  }\n\n  section(key, options = { optional: false }) {\n    const newSectionAttributes = this.attributes[key];\n    const newSectionName = this.sectionName ? `${this.sectionName}.${key}` : key;\n\n    if (!newSectionAttributes) {\n      return options.optional ? null : new ResolvedConfig({}, newSectionName);\n    }\n\n    switch (typeof newSectionAttributes) {\n      case 'object':\n        return new ResolvedConfig(newSectionAttributes, newSectionName);\n      case 'string':\n        return interpolateSection(newSectionAttributes, newSectionName, options.optional);\n      default:\n        throw new Error(`config: option [${key}] should be an object`);\n    }\n  }\n}\n\n\nfunction loadConfigFromFile(fileName) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(fileName, 'utf8', (err, data) => {\n      if (err) {\n        reject(new Error(`error reading config file: ${err.message}`));\n      } else {\n        resolve(JSON.parse(data));\n      }\n    });\n  });\n}\n\nfunction resolveConfig(attributes, overrides) {\n  return new ResolvedConfig(Object.assign({}, attributes, overrides));\n}\n\nfunction interpolateConfigValue(value, optional = false) {\n  if (typeof value === 'string') {\n    const match  = value.match(/^\\${(.+)}$/);\n    if (match) {\n      return interpolateConfigValue(\n        interpolateExpression(match[1], optional),\n        optional\n      );\n    }\n  }\n\n  return value;\n}\n\nfunction interpolateExpression(expression, optional = false) {\n  const parts = expression.split('.');\n  let firstPart = true;\n  let value = null;\n\n  for (const part of parts) {\n    if (firstPart) {\n      firstPart = false;\n      value = first(part, optional);\n      if (value === undefined && optional) {\n        return undefined;\n      }\n      if (value === 'true' || value === 'false') {\n        value = JSON.parse(value);\n      }\n    } else {\n      value = next(value, part);\n    }\n  }\n\n  return value;\n\n  function first(part, optional) {\n    if (!process.env[part]) {\n      if (optional) {\n        return undefined;\n      }\n\n      throw new Error(\n        `config: cannot interpolate expression [${expression}]: ` +\n        `environment variable ${part} is not set`\n      );\n    }\n\n    let value = process.env[part];\n\n    if (parts.length > 1) {\n      try {\n        value = JSON.parse(value);\n      } catch (e) {\n        throw new Error(\n          `config: cannot interpolate expression [${expression}]: ` +\n          `environment variable ${part} is not a valid JSON`\n        );\n      }\n    }\n\n    return value;\n  }\n\n  function next(value, part) {\n    if (Array.isArray(value)) {\n      if (value.length !== 1) {\n        throw new Error(\n          `config: cannot interpolate expression [${expression}]: ` +\n          `item [${part}] is an array of length ${value.length}`\n        );\n      }\n      return next(value[0], part);\n\n    } else if (typeof value === 'object') {\n      return value[part];\n\n    } else {\n      throw new Error(\n        `config: cannot interpolate expression [${expression}]: ` +\n        `key path missing at ${part}`\n      );\n    }\n  }\n}\n\nfunction interpolateSection(expression, sectionName, optional) {\n  let attributes = interpolateConfigValue(expression, optional);\n\n  if (attributes) {\n    try {\n      attributes = JSON.parse(attributes);\n      if (typeof attributes !== 'object') {\n        attributes = null;\n      }\n    } catch (e) {\n      attributes = null;\n    }\n\n    if (!attributes) {\n      throw new Error(\n        `config: ${sectionName}: cannot interpolate expression [${expression}]: ` +\n        'object expected'\n      );\n    }\n  }\n\n  if (attributes) {\n    return new ResolvedConfig(attributes, sectionName);\n  } else if (!optional) {\n    return new ResolvedConfig({}, sectionName);\n  } else {\n    return null;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","module.exports = require(\"babel-runtime/core-js/get-iterator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/get-iterator\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 10\n// module chunks = 0","import createRedisDataStore from './redis/createRedisDataStore';\nimport createMemoryDataStore from './memory/createMemoryDataStore';\n\n\nexport default async function createDataStore(config) {\n  const dataStoreConfig = (await config.load()).section('dataStore', { optional: true });\n\n  if (dataStoreConfig && dataStoreConfig.optional('type') === 'redis') {\n    return createRedisDataStore(dataStoreConfig.section('settings'));\n  } else {\n    return createMemoryDataStore();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/createDataStore.js","import RedisDataStore from './RedisDataStore';\nimport createRedisClient from './createRedisClient';\n\n\nexport default function createRedisDataStore(config) {\n  return new RedisDataStore(createRedisClient('riv-us', config));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/redis/createRedisDataStore.js","import moment from 'moment';\n\nimport log from '../../log';\nimport { momentize, demomentize } from '../../services/momentize';\n\nconst Keys = {\n  post: id => `rivus:posts:${id}`,\n  providerLastPostDate: p => `rivus:anchor:provider:${p.feedId}`,\n  providerPostIds: p => `rivus:provider:${p.feedId}`,\n  feedLastPostDates: f => `rivus:anchor:feed:${f.getFeedId()}`,\n  feedPostIds: f => `rivus:feed:${f.getFeedId()}`\n};\n\n\nexport default class RedisDataStore {\n  constructor(client) {\n    this.client = client;\n  }\n\n  async synchronizeProvider(provider, updater) {\n    const lastPostDateKey = Keys.providerLastPostDate(provider);\n\n    await redisQuery(this.client, 'watch', lastPostDateKey);\n\n    const providerLastPostDate = dateFromRedis(await redisQuery(this.client, 'get', lastPostDateKey));\n\n    const writeStore = new RedisWriteDataStore(this.client);\n\n    try {\n      const newProviderLastPostDate = await updater(providerLastPostDate, writeStore);\n      writeStore.saveLastProviderPostDate(provider, newProviderLastPostDate);\n      await writeStore.commit();\n      return newProviderLastPostDate;\n\n    } catch (e) {\n      log.warn(`Redis: error while synchronizing provider \\`${provider.feedId}\\`:`, e);\n      writeStore.discard();\n      throw e;\n    }\n  }\n\n  async synchronizeFeed(feed, updater) {\n    const lastPostDatesKey = Keys.feedLastPostDates(feed);\n\n    await redisQuery(this.client, 'watch', lastPostDatesKey);\n\n    let lastPostDates = await redisQuery(this.client, 'get', lastPostDatesKey);\n    if (lastPostDates) {\n      lastPostDates = JSON.parse(lastPostDates);\n      if (Array.isArray(lastPostDates)) {\n        lastPostDates = lastPostDates.map(dateFromRedis);\n      } else {\n        lastPostDates = null;\n      }\n    }\n\n    const writeStore = new RedisWriteDataStore(this.client);\n\n    try {\n      const newLastPostDates = await updater(lastPostDates, writeStore);\n      writeStore.saveLastFeedPostDates(feed, newLastPostDates);\n      await writeStore.commit();\n      return newLastPostDates;\n\n    } catch (e) {\n      log.warn(`Redis: error while synchronizing feed \\`${feed.getFeedId()}\\`:`, e);\n      writeStore.discard();\n      throw e;\n    }\n  }\n\n  async getFeedPosts(feed, offset = 0, limit = 10) {\n    const postIds = await redisQuery(\n      this.client,\n      'zrevrangebyscore',\n      Keys.feedPostIds(feed),\n      Number.MAX_VALUE,\n      0,\n      'LIMIT',\n      offset,\n      limit\n    );\n\n    return await loadPostsByIds(this.client, postIds);\n  }\n\n  async getProviderPosts(provider, endDate = null, startDate = null) {\n    const postIds = await redisQuery(\n      this.client,\n      'zrangebyscore',\n      Keys.providerPostIds(provider),\n      dateToRedis(startDate, '-inf'),\n      dateToRedis(endDate, '+inf')\n    );\n\n    return await loadPostsByIds(this.client, postIds);\n  }\n\n  async drop() {\n    return await redisQuery(this.client, 'flushdb');\n  }\n}\n\n\nclass RedisWriteDataStore {\n  constructor(client) {\n    this.client = client.multi();\n  }\n\n  async commit() {\n    return await redisQuery(this.client, 'exec');\n  }\n\n  discard() {\n    redisOneOffQuery(this.client, 'discard');\n  }\n\n  savePosts(posts) {\n    if (!posts.length) {\n      return;\n    }\n    const args = posts.reduce((arr, post) => [...arr, Keys.post(post.id), JSON.stringify(demomentize(post))], []);\n    redisOneOffQuery(this.client, 'mset', ...args)\n  }\n\n  saveLastProviderPostDate(provider, date) {\n    redisOneOffQuery(this.client, 'set', Keys.providerLastPostDate(provider), dateToRedis(date));\n  }\n\n  saveLastFeedPostDates(feed, dates) {\n    redisOneOffQuery(\n      this.client,\n      'set',\n      Keys.feedLastPostDates(feed),\n      dates ? JSON.stringify(dates.map(dateToRedis)) : null\n    );\n  }\n\n  addPostsToFeed(feed, posts) {\n    if (!posts.length) {\n      return;\n    }\n\n    const args = posts.reduce((arr, post) => [...arr, dateToRedis(post.created_time), post.id], []);\n    redisOneOffQuery(this.client, 'zadd', Keys.feedPostIds(feed), ...args);\n  }\n\n  addPostsToProvider(provider, posts) {\n    if (!posts.length) {\n      return;\n    }\n\n    const args = posts.reduce((arr, post) => [...arr, dateToRedis(post.created_time), post.id], []);\n    redisOneOffQuery(this.client, 'zadd', Keys.providerPostIds(provider), ...args);\n  }\n}\n\nasync function loadPostsByIds(client, postIds) {\n  if (!postIds.length) {\n    return [];\n  }\n  return (await redisQuery(client, 'mget', ...postIds.map(Keys.post)))\n    .map(data => momentize(JSON.parse(data)));\n}\n\nasync function redisQuery(client, command, ...args) {\n  log.debug(`Redis: ${command}`, ...args.map(arg => `\"${arg}\"`));\n\n  return await new Promise((resolve, reject) => {\n    if (!client[command]) {\n      reject(new Error(`Redis: undefined command ${command}`));\n      return;\n    }\n\n    client[command](...[...args, (err, response) => {\n      if (err) {\n        log.warn(`Redis: error ${command}`, ...args.map(arg => `\"${arg}\"`), ':', err);\n        reject(new Error(`Redis: ${err.message}`));\n      } else {\n        resolve(response);\n      }\n    }]);\n  });\n}\n\nfunction redisOneOffQuery(client, command, ...args) {\n  log.debug(`Redis: ${command}`, ...args.map(arg => `\"${arg}\"`));\n\n  if (!client[command]) {\n    throw new Error(`Redis: undefined command ${command}`);\n  }\n\n  client[command](...args);\n}\n\nfunction dateToRedis(date, defaultValue) {\n  return date ? date.valueOf() : defaultValue;\n}\n\nfunction dateFromRedis(redisDate) {\n  return redisDate ? moment(Number(redisDate)) : null;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/redis/RedisDataStore.js","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/toConsumableArray\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 16\n// module chunks = 0","import winston from 'winston';\n\nconst disableLog = process.env.NODE_ENV === 'test' && !process.env.RIVUS_LOG_LEVEL;\nconst logLevel = process.env.RIVUS_LOG_LEVEL || 'info';\nconst prettyLog = !process.env.RIVUS_LOG_SIMPLE;\n\nconst logParams = {\n  console: {\n    level: logLevel,\n    colorize: prettyLog,\n    timestamp: true,\n    prettyPrint: prettyLog,\n    humanReadableUnhandledException: true\n  }\n};\n\n\nconst log = winston.loggers.add('rivus', logParams);\nif (disableLog) {\n  winston.loggers.get('rivus').remove(winston.transports.Console)\n}\n\nexport default log;\n\n\n\n// WEBPACK FOOTER //\n// ./src/log.js","module.exports = require(\"winston\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"winston\"\n// module id = 18\n// module chunks = 0","import moment from 'moment';\n\nexport function momentize(post) {\n  if (!moment.isMoment(post.created_time)) {\n    return {\n      ...post,\n      created_time: moment(post.created_time)\n    };\n  }\n  return post;\n}\n\nexport function demomentize(post) {\n  if (moment.isMoment(post.created_time)) {\n    return {\n      ...post,\n      created_time: post.created_time.valueOf()\n    };\n  }\n  return post;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/momentize.js","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 20\n// module chunks = 0","import redis from 'redis';\n\nimport log from '../../log';\n\n\nexport default function createRedisClient(storeName, config) {\n  const params = {};\n\n  if (config.optional('path')) {\n    params.path = config.optional('path');\n  } else {\n    params.host = config.optional('host', '127.0.0.1');\n    params.port = config.optional('port', 6379);\n  }\n\n  if (config.optional('password')) {\n    params.password = config.optional('password');\n  }\n\n  log.debug(`${storeName}: using Redis data store: `, params);\n\n  const client = redis.createClient(params);\n\n  client.on('error', e => log.error(`${storeName}: redis store: `, e));\n  client.on('warning', (...args) => log.warn(...[`${storeName}: redis store: warning: `, ...args]));\n  client.on('reconnecting', () => log.warn(`${storeName}: redis store: reconnecting to server...`));\n  client.on('connect', () => {\n    log.info(`${storeName}: redis store: connected to server`);\n  });\n\n  return client;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/redis/createRedisClient.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 22\n// module chunks = 0","import fakeredis from 'fakeredis';\n\nimport log from '../../log';\nimport RedisDataStore from '../redis/RedisDataStore';\n\n\nexport default function createMemoryDataStore() {\n  log.info('riv-us: using in-memory data store');\n\n  const fakeClient = fakeredis.createClient(888, 'riv-us', { fast: true });\n\n  return new RedisDataStore(fakeClient);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/dataStore/memory/createMemoryDataStore.js","module.exports = require(\"fakeredis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fakeredis\"\n// module id = 24\n// module chunks = 0","import createProvider from '../providers/createProvider';\n\nimport { ResolvedConfig } from '../config';\nimport getFeedId from './getFeedId';\n\n\nexport default async function createFeed(config) {\n  const loadedConfig = await config.load();\n  const providers = loadedConfig.mandatory('providers').map(providerAttributes =>\n    createProvider(new ResolvedConfig(providerAttributes)));\n\n  const filters = [];\n\n  return {\n    getProviders: () => providers,\n    getFeedId: () => getFeedId(providers),\n    addFilter: (filter) => {\n      if (typeof filter !== 'function') {\n        throw new Error('filter must be a function');\n      }\n\n      const i = filters.indexOf(filter);\n      if (i < 0) {\n        filters.push(filter);\n      }\n    },\n    removeFilter: (filter) => {\n      if (typeof filter !== 'function') {\n        throw new Error('filter must be a function');\n      }\n\n      const i = filters.indexOf(filter);\n      if (i >= 0) {\n        filters.splice(i, 1);\n      }\n    },\n    filterPosts: (posts) => {\n      if (filters.length) {\n        return posts.filter(p => filters.every(f => f(p)));\n      }\n\n      return posts;\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/feed/createFeed.js","import createFacebookProvider from './facebook/facebook';\nimport createTwitterProvider from './twitter/twitter';\nimport createRssProvider from './rss/rss';\nimport createMediumProvider from './medium/medium';\nimport createInstagramProvider from './instagram/instagram';\n\n\nexport default function createProvider(config) {\n  const name = config.mandatory('name');\n  switch (name) {\n    case 'facebook':\n      return createFacebookProvider(config);\n    case 'medium':\n      return createMediumProvider(config);\n    case 'twitter':\n      return createTwitterProvider(config);\n    case 'rss':\n      return createRssProvider(config);\n    case 'instagram':\n      return createInstagramProvider(config);\n    default:\n      throw new Error(`unknown provider type \\`${name}\\``);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/createProvider.js","'use strict';\n\nimport querystring from 'querystring';\nimport moment from 'moment';\nimport url from 'url';\n\nimport createAccessToken from './accessToken';\nimport graphApiRequest, { FACEBOOK_HOST } from './graphApiRequest';\n\n\nexport default function createFacebookProvider(config) {\n  const userId = config.mandatory('user_id');\n  const feedId = `facebook:user:${userId}`;\n  const accessToken = createAccessToken(config.mandatory('app_id'), config.mandatory('app_secret'));\n\n  const provider = {\n    fetchPosts: async(limit = 10, pageToken = null) => {\n      let posts = [];\n      let nextPageToken = pageToken;\n\n      while (posts.length < limit) {\n        const response = await fetchPosts(feedId, userId, accessToken, nextPageToken);\n        posts = posts.concat(response.posts);\n        nextPageToken = posts.nextPageToken;\n      }\n\n      return {\n        posts,\n        nextPageToken\n      };\n    }\n  };\n  Object.defineProperty(provider, 'feedId', { get: () => feedId });\n  return provider;\n}\n\nasync function fetchPosts(feedId, userId, accessToken, nextPageToken) {\n  let endpoint;\n\n  if (nextPageToken) {\n    endpoint = url.parse(nextPageToken);\n  } else {\n    const params = {\n      fields: 'message,link,message_tags,name,picture,full_picture,type,created_time,source,story_tags'\n    };\n    endpoint = url.parse('https://' + FACEBOOK_HOST + '/' + userId + '/feed?' + querystring.encode(params));\n  }\n\n  const response = await graphApiRequest(endpoint, await accessToken.request());\n\n  return {\n    posts: response.data.map(p => cookFeedItem(p, feedId)),\n    nextPageToken: (response.paging || {}).next\n  };\n}\n\nfunction cookFeedItem(feedId, post) {\n  const parseImages = () => {\n    const images = {};\n\n    if (post.picture && post.picture.length) {\n      images.thumbnail = { url: post.picture };\n    }\n\n    if (post.full_picture && post.full_picture.length) {\n      images.content = { url: post.full_picture };\n    }\n\n    return images;\n  };\n\n  return {\n    id: `fb:${post.id}`,\n    title: post.name,\n    content: post.message,\n    created_time: moment(new Date(post.created_time).getTime()),\n    images: parseImages(),\n    link: post.link,\n    extra: {\n      original: post\n    },\n    source: {\n      name: 'facebook',\n      feed: feedId\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/facebook/facebook.js","module.exports = require(\"querystring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"querystring\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url\"\n// module id = 29\n// module chunks = 0","import url from 'url';\nimport querystring from 'querystring';\n\nimport graphApiRequest, { FACEBOOK_HOST } from './graphApiRequest';\n\n\nexport default function createAccessToken(appId, appSecret) {\n  let promise = null;\n\n  return {\n    request: async() => {\n      if (promise) {\n        return await promise;\n      }\n      promise = requestNewAccessToken(appId, appSecret);\n      return promise;\n    },\n    invalidate: () => {\n      promise = null;\n    }\n  }\n}\n\nasync function requestNewAccessToken(appId, appSecret) {\n  const params = {\n    client_id: appId,\n    client_secret: appSecret,\n    grant_type: 'client_credentials'\n  };\n\n  const endpoint = url.parse('https://' + FACEBOOK_HOST + '/oauth/access_token?' + querystring.encode(params));\n  const responseString = await graphApiRequest(endpoint);\n\n  const items = responseString.split('=');\n  if (items.length === 2 && items[0] === 'access_token') {\n    return items[1];\n  }\n\n  throw new Error(`failed getting access token from Facebook: received this instead of a token: \\`${responseString}\\``);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/providers/facebook/accessToken.js","import https from 'https';\n\n\nexport const FACEBOOK_HOST = 'graph.facebook.com';\n\n\nexport default async function graphApiRequest(endpoint, accessToken) {\n  return await new Promise((resolve, reject) => {\n    const headers = {};\n    if (accessToken) {\n      headers['access-token'] = accessToken;\n    }\n\n    const request = https.get({\n      hostname: endpoint.hostname,\n      path: endpoint.path,\n      headers: headers\n    }, message => {\n      message.on('data', responseData => {\n        if (message.statusCode === 200) {\n          try {\n            const responseString = responseData.toString('utf8');\n            const plainResponse = !accessToken;\n\n            if (plainResponse) {\n              resolve(responseString);\n            } else {\n              resolve(JSON.parse(responseString));\n            }\n          } catch (e) {\n            reject(new Error(`error processing Facebook response: ${e.message}`));\n          }\n\n        } else {\n          try {\n            const json = JSON.parse(responseData.toString('utf8'));\n            if (json.error) {\n              reject(new Error(\n                `error calling Facebook: fb error ${json.error.code}/${json.error.error_subcode}: ` +\n                `${json.error.error_user_title}; ` +\n                `${json.error.error_user_message}`\n              ));\n            } else {\n              reject(new Error(`error calling Facebook: HTTP ${message.statusCode} ${message.statusMessage}`));\n            }\n          } catch (e) {\n            reject(new Error(`error processing Facebook response: HTTP ${message.statusCode} ${message.statusMessage}`));\n          }\n        }\n      });\n    });\n\n    request.on('error', error => {\n      reject(new Error(`error calling Facebook: ${error.message}`));\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/providers/facebook/graphApiRequest.js","module.exports = require(\"https\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"https\"\n// module id = 32\n// module chunks = 0","import TwitterApi from 'twitter';\nimport moment from 'moment';\n\n\nexport default function createTwitterProvider(config) {\n  const user = config.mandatory('user');\n  const feedId = feedIdForUser(user);\n\n  const twitter = new TwitterApi({\n    consumer_key: config.mandatory('consumer_key'),\n    consumer_secret: config.mandatory('consumer_secret'),\n    access_token_key: config.mandatory('access_token_key'),\n    access_token_secret: config.mandatory('access_token_secret')\n  });\n\n  const provider = {\n    fetchPosts: async(limit = 10, pageToken = null) => {\n      const params = {\n        screen_name: user,\n        count: limit\n      };\n\n      if (pageToken) {\n        params.max_id = pageToken;\n      }\n\n      return await new Promise((resolve, reject) => {\n        twitter.get('statuses/user_timeline', params, (err, tweets) => {\n          if (err) {\n            reject(new Error(`failed calling Twitter: ${err.message}`));\n          } else {\n            const items = tweets.map(t => cookFeedPost(feedId, t));\n            resolve({\n              posts: tweets.map(t => cookFeedPost(feedId, t)),\n              nextPageToken: items.length ? items.slice(-1)[0].id : null\n            });\n          }\n        });\n      });\n    }\n  };\n  Object.defineProperty(provider, 'feedId', {\n    get: () => feedId\n  });\n  return provider;\n}\n\nfunction cookFeedPost(feedId, original) {\n  return {\n    id: `twi:${original.id}`,\n    title: null,\n    content: original.text,\n    created_time: moment(new Date(original.created_at).getTime()),\n    images: images(original.extended_entities),\n    extra: { original },\n    link: 'https://twitter.com/' + original.user.screen_name + '/status/' + original.id_str,\n    source: {\n      name: 'twitter',\n      feed: feedId\n    }\n  };\n}\n\nfunction images(entities) {\n  if (!entities || !Array.isArray(entities.media) || !entities.media[0]) {\n    return {};\n  }\n\n  return {\n    thumbnail: {\n      url: entities.media[0].media_url_https || entities.media[0].media_url\n    }\n  };\n}\n\nfunction feedIdForUser(user) {\n  return `twitter:${user}`;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/twitter/twitter.js","module.exports = require(\"twitter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"twitter\"\n// module id = 34\n// module chunks = 0","import feed from 'feed-read';\nimport moment from 'moment';\n\nimport log from '../../log';\n\n\nexport default function createRssProvider(config, overrides = {}) {\n  const feedUrl = overrides && overrides.feedUrl || config.mandatory('feed_url');\n  const feedId = overrides && overrides.feedId || `rss:${feedUrl}`;\n  const providerName = overrides && overrides.providerName || 'rss';\n\n  const provider = {\n    fetchPosts: async () => {\n      log.verbose(`provider \\`${feedId}\\`: fetch posts...`);\n\n      return await new Promise((resolve, reject) => {\n        feed(feedUrl, (err, response) => {\n          try {\n            if (err) {\n              throw err;\n            }\n\n            const posts = response.map(p => cookFeedItem(feedId, providerName, p));\n\n            log.verbose(`provider \\`${feedId}\\`: fetch complete: ${posts.length} posts`);\n            resolve({\n              posts: posts,\n              nextPageToken: null\n            });\n          } catch (e) {\n            log.error(`provider \\`${feedId}\\`: error calling RSS: `, err);\n            reject(e);\n          }\n        });\n      })\n    }\n  };\n  Object.defineProperty(provider, 'feedId', {\n    get: () => feedId\n  });\n  return provider;\n}\n\nfunction cookFeedItem(feedId, providerName, original) {\n  delete original.feed; // feed-read service stuff\n  return {\n    id: `${providerName}:${original.link}`,\n    title: original.title,\n    content: original.content,\n    created_time: moment(new Date(original.published).getTime()),\n    images: images(original.content),\n    link: original.link,\n    extra: { original },\n    source: {\n      name: providerName,\n      feed: feedId\n    }\n  };\n}\n\nfunction images(content) {\n  const rex = /src=\"([^\"]*)\"/i;\n  const match = rex.exec(content);\n  if (Array.isArray(match) && match[1]) {\n    return {\n      thumbnail: {\n        url: match[1]\n      }\n    };\n  }\n  return {};\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/rss/rss.js","module.exports = require(\"feed-read\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"feed-read\"\n// module id = 36\n// module chunks = 0","import url from 'url';\nimport createRssProvider from '../rss/rss';\n\n\nexport default function createMediumProvider(config) {\n  return createRssProvider(null, createRssConfig(config));\n}\n\nfunction createRssConfig(mediumConfig) {\n  if (mediumConfig.optional('user')) {\n    return {\n      feedUrl: 'https://medium.com/feed/' + mediumConfig.optional('user'),\n      feedId: feedId('user', mediumConfig.optional('user')),\n      providerName: 'medium'\n    };\n  } else if (mediumConfig.optional('publication')) {\n    return {\n      feedUrl: 'https://medium.com/feed/' + mediumConfig.optional('publication'),\n      feedId: feedId('publication', mediumConfig.optional('publication')),\n      providerName: 'medium'\n    };\n  } else if (mediumConfig.optional('publication_with_custom_domain')) {\n    const customDomainUrl = url.parse(mediumConfig.optional('publication_with_custom_domain'));\n    customDomainUrl.pathname = '/feed';\n\n    return {\n      feedUrl: customDomainUrl.format(),\n      feedId: feedId('publication_with_custom_domain', mediumConfig.optional('publication_with_custom_domain')),\n      providerName: 'medium'\n    };\n  }\n  throw new Error('medium provider: config is invalid');\n}\n\nfunction feedId(type, id) {\n  return `medium:${type}:${id}`;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/medium/medium.js","import https from 'https';\nimport querystring from 'querystring';\nimport moment from 'moment';\n\nconst API_BASE_URL = 'https://api.instagram.com/v1/users/self/media/recent/';\n\n\nexport default function createInstagramProvider(config) {\n  const user = config.optional('user', 'own');\n  const accessToken = config.mandatory('access_token');\n  const feedId = feedIdForUser(user, accessToken);\n\n  const provider = {\n    fetchPosts: async(limit = 10, pageToken = null) => {\n      const params = { access_token: accessToken };\n      if (pageToken) {\n        params.next_max_id = pageToken;\n      }\n\n      const url = API_BASE_URL + '?' + querystring.stringify(params);\n\n      const response = await new Promise((resolve, reject) => {\n        const request = https.get(url, message => {\n          let body = '';\n          message.on('data', responseData => body += responseData.toString('utf8'));\n          message.on('end', () => resolve(JSON.parse(body)));\n        });\n\n        request.on('error', error => reject(\n          new Error(`Failed calling Instagram: ${error.message}`)\n        ));\n      });\n\n      if (!response.meta) {\n        throw new Error(`Failed calling Instagram: invalid response: \\`${JSON.stringify(response)}\\``);\n      }\n\n      if (response.meta.code !== 200) {\n        throw new Error(`Failed calling Instagram: failing response: \\`${JSON.stringify(response)}\\``);\n      }\n\n      return {\n        posts: response.data ? response.data.map(p => cookFeedItem(feedId, p)) : [],\n        nextPageToken: response.pagination ? response.pagination.next_max_id : null\n      };\n    }\n  };\n  Object.defineProperty(provider, 'feedId', {\n    get: () => feedId\n  });\n  return provider;\n}\n\nfunction cookFeedItem(feedId, original) {\n  return {\n    id: 'inst:' + original.id,\n    title: original.caption && original.caption.text.substring(0, 20),\n    content: original.caption && original.caption.text,\n    created_time: moment(new Date(original.created_time * 1000).getTime()),\n    images: {\n      thumbnail: {\n        url: original.images.thumbnail.url\n      },\n      content: {\n        url: original.images.standard_resolution.url\n      }\n    },\n    link: original.link,\n    extra: { original },\n    source: {\n      name: 'instagram',\n      feed: feedId\n    }\n  };\n}\n\nfunction feedIdForUser(user, accessToken) {\n  if (user === 'own') {\n    return `instagram:own:${accessToken}`;\n  } else {\n    return `instagram:user:${user}`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/instagram/instagram.js","export default function getFeedId(providers) {\n  return providers.slice()\n    .sort((p1, p2) => {\n      const f1 = p1.feedId;\n      const f2 = p2.feedId;\n\n      if (f1 < f2) {\n        return -1;\n      } else if (f1 > f2) {\n        return 1;\n      }\n      return 0;\n    })\n    .map(provider => provider.feedId)\n    .join('|');\n}\n\n\n// WEBPACK FOOTER //\n// ./src/feed/getFeedId.js","import log from '../log';\nimport deduplicatePosts from '../services/deduplicatePosts';\n\n\nexport default async function synchronize(feed, dataStore) {\n  const feedId = feed.getFeedId();\n\n  log.info(`synchronizing feed ${feedId}...`);\n\n  try {\n    const providers = feed.getProviders();\n    const newFeedDates = await Promise.all(providers.map(p => synchronizeProvider(dataStore, p)));\n    await mergeProviderUpdatesToFeed(feed, dataStore, providers, newFeedDates);\n\n    log.info(`completed synchronizing feed ${feedId}`);\n  } catch (e) {\n    log.error(`error while synchronizing feed ${feedId}`, e);\n    throw e;\n  }\n}\n\nasync function synchronizeProvider(dataStore, provider) {\n  return await dataStore.synchronizeProvider(provider, async(savedLastPostDate, writeStore) => {\n    const newPosts = await loadNewPostsFromProvider(provider, savedLastPostDate);\n    if (!newPosts.length) {\n      return savedLastPostDate;\n    }\n    writeStore.savePosts(newPosts);\n    writeStore.addPostsToProvider(provider, newPosts);\n    return newPosts[0].created_time;\n  });\n}\n\nasync function mergeProviderUpdatesToFeed(feed, dataStore, providers, newFeedDates) {\n  return await dataStore.synchronizeFeed(feed, async(savedFeedDates, writeStore) => {\n    const updates = collectUpdatesInFeed(providers, savedFeedDates, newFeedDates);\n\n    if (!updates.length) {\n      return savedFeedDates;\n    }\n    \n    const posts = deduplicatePosts(feed.filterPosts(await getPostsFromUpdates(updates, dataStore)));\n    writeStore.addPostsToFeed(feed, posts);\n\n    return newFeedDates;\n  });\n}\n\nfunction collectUpdatesInFeed(providers, savedFeedDates, newFeedDates) {\n  return providers\n    .map((provider, index) => {\n      let startDate = savedFeedDates ? savedFeedDates[index] : null;\n      const endDate = newFeedDates[index];\n\n      if (!startDate && !endDate) {\n        return null;\n      }\n\n      return {\n        provider: provider,\n        startDate: startDate,\n        endDate: endDate\n      };\n    })\n    .filter(update => !!update && (!update.startDate || update.endDate.isAfter(update.startDate)));\n}\n\nasync function getPostsFromUpdates(updates, dataStore) {\n  const posts = await Promise.all(updates.map(async(update) => {\n      const posts = await dataStore.getProviderPosts(update.provider, update.endDate, update.startDate);\n\n      if (update.startDate && update.startDate.isSame(posts[posts.length - 1].created_time)) {\n        return posts.slice(0, -1);\n      } else {\n        return posts;\n      }\n    })\n  );\n\n  return posts.reduce((allPosts, providerPosts) => allPosts.concat(providerPosts), []);\n}\n\nasync function loadNewPostsFromProvider(provider, savedPostDate) {\n  async function loadNewPostsFromProviderRec(pageToken) {\n    const newFeed = await provider.fetchPosts(20, pageToken);\n    const thisPagePosts = [];\n\n    for (let i = 0; i < newFeed.posts.length; i++) {\n      const postDate = newFeed.posts[i].created_time;\n\n      if (!!savedPostDate && postDate.isSameOrBefore(savedPostDate)) {\n        return thisPagePosts;\n      }\n\n      thisPagePosts.push(newFeed.posts[i]);\n    }\n\n    if (!thisPagePosts.length || !newFeed.nextPageToken) {\n      return thisPagePosts;\n    }\n\n    const nextPagePosts = await loadNewPostsFromProviderRec(newFeed.nextPageToken);\n    return thisPagePosts.concat(nextPagePosts);\n  }\n\n  return await loadNewPostsFromProviderRec();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/synchronize.js","const DEDUPLICATION_TIME_WINDOW = 3000; // 3 seconds\n\nexport default function deduplicatePosts(posts) {\n  // TODO: make me smarter\n  const duplicateIds = findDuplicates(groupPostsByTimeWindow(posts));\n  return posts.filter(p => !duplicateIds.has(p.id));\n}\n\nfunction groupPostsByTimeWindow(posts) {\n  const postsByTimeWindow = {};\n\n  posts.forEach(post => {\n    const window = Math.floor(post.created_time.valueOf() / DEDUPLICATION_TIME_WINDOW);\n    postsByTimeWindow[window] = postsByTimeWindow[window] || [];\n    postsByTimeWindow[window].push(post);\n  });\n\n  return postsByTimeWindow;\n}\n\nfunction findDuplicates(postsByTimeWindow) {\n  const duplicateIds = new Set();\n\n  Object.keys(postsByTimeWindow).forEach(window => {\n    const posts = postsByTimeWindow[window];\n    if (posts.length > 0) {\n      posts\n        .sort((p1, p2) => providerPriority(p1.source.name) - providerPriority(p2.source.name))\n        .slice(1)\n        .forEach(p => duplicateIds.add(p.id));\n    }\n  });\n\n  return duplicateIds;\n}\n\nfunction providerPriority(providerName){\n  switch (providerName) {\n    case 'instagram':\n      return 100;\n    case 'medium':\n      return 50;\n    case 'facebook':\n      return 5;\n    case 'twitter':\n      return 1;\n    default:\n      return 0;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/services/deduplicatePosts.js","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/set\"\n// module id = 43\n// module chunks = 0"],"sourceRoot":""}